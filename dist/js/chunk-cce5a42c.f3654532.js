(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-cce5a42c"],{4194:function(t,e,i){"use strict";var a=i("1c8b"),n=i("5dfd").find,s=i("258f"),r=i("ff9c"),c="find",o=!0,d=r(c);c in[]&&Array(1)[c]((function(){o=!1})),a({target:"Array",proto:!0,forced:o||!d},{find:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}}),s(c)},"7fe2":function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"md-detail",attrs:{flex:""}},[i("div",{staticClass:"operate",attrs:{flex:""}},[i("div",{staticClass:"back",attrs:{flex:""},on:{click:function(e){return t.$router.push("/article")}}},[i("svg-icon",{attrs:{name:"back"}}),i("span",[t._v("返回")])],1),i("single-button",{staticClass:"del-cache",attrs:{disabled:!t.hasCache,text:"删除草稿",size:.9},nativeOn:{click:function(e){return t.delCache(e)}}}),i("single-button",{staticClass:"use-cache",attrs:{disabled:!t.hasCache,text:"使用草稿",size:.9},nativeOn:{click:function(e){return t.useCache(e)}}}),i("single-button",{staticClass:"save-cache",attrs:{text:"保存草稿",size:.9},nativeOn:{click:function(e){return t.saveCache(e)}}}),i("loading-button",{attrs:{loading:t.saving.b,text:"上传",icon:"save"},nativeOn:{click:function(e){return t.save(e)}}}),i("span",{staticClass:"state"},[t._v(t._s(t.saving.state))])],1),i("div",{staticClass:"head",attrs:{flex:""}},[i("float-input",{attrs:{name:"标题",size:1.3,value:t.info.name},on:{input:t.inputTitle}}),i("float-input",{staticClass:"summary",attrs:{name:"简介",size:1,value:t.info.summary},on:{input:t.inputSummary}})],1),i("div",{staticClass:"info",attrs:{flex:""}},[i("div",{staticClass:"cover"},[i("loading-img",{directives:[{name:"viewer",rawName:"v-viewer"}],attrs:{src:t.info.cover,size:[20,15],"data-viewer":!0}}),i("label",{attrs:{flex:""}},[i("span",[t._v("封面链接:")]),i("input",{domProps:{value:t.info.cover},on:{focusout:t.changeCover}})])],1),i("div",{staticClass:"tags-time",attrs:{flex:""}},[i("div",{staticClass:"tags",attrs:{flex:""}},[i("span",{staticClass:"tag-icon",attrs:{flex:""}},[i("svg-icon",{attrs:{name:"tag"}})],1),t._l(t.info.tags,(function(e,a){return i("div",{key:e,class:{editing:t.tagEditIndex===a}},[i("input",{attrs:{disabled:t.tagEditIndex!==a,"data-old":e,"data-idx":a},domProps:{value:e},on:{focusout:t.editTag}}),i("div",{attrs:{flex:""}},[i("span",{attrs:{title:"删除"},on:{click:function(e){return t.clickTrash(a)}}},[i("svg-icon",{attrs:{name:"trash"}})],1),i("span",{attrs:{"data-idx":a,title:"编辑"},on:{click:t.clickEdit}},[i("svg-icon",{attrs:{name:"edit"}})],1)])])})),i("span",{staticClass:"add",attrs:{title:"添加标签",flex:""},on:{click:t.addTag}},[i("svg-icon",{attrs:{name:"add"}})],1)],2),i("div",{staticClass:"time",attrs:{flex:""}},[i("span",[i("span",[t._v("创建:")]),t._v(t._s(t._f("time")(t.info?t.info.time:0,!1)))]),i("span",[i("span",[t._v("修改:")]),t._v(t._s(t._f("time")(t.info?t.info.modifyTime:0,!1)))])])])]),i("div",{ref:"text",staticClass:"text",attrs:{flex:""}},[i("div",{staticClass:"head",attrs:{flex:""}},[i("span",{class:{active:t.showSticker},attrs:{title:"表情",flex:""},on:{click:t.enableSticker}},[i("svg-icon",{attrs:{name:"cmt-sticker"}})],1),i("span",{staticClass:"markdown-guide",attrs:{title:"markdown语法指南",flex:""},on:{click:function(e){t.showGuide=!0}}},[i("svg-icon",{attrs:{name:"markdown"}})],1),t.config.sticker?i("div",{ref:"sticker",staticClass:"sticker",class:{active:t.showSticker},attrs:{flex:""}},[i("div",{staticClass:"content"},[i("div",{staticClass:"inner",style:{width:t.config.sticker.length+"00%",left:-100*t.stickerSlideNow+"%"},attrs:{flex:""}},t._l(t.config.sticker,(function(e){return i("div",{style:{width:100/t.config.sticker.length+"%"},attrs:{flex:""}},t._l(e.count,(function(a){return i("span",{attrs:{flex:""},on:{click:function(i){return t.addSticker(e.folder,a)}}},[i("img",{attrs:{src:t.baseUrl+"/sticker/"+e.folder+"/"+a+".png?ran="+t.stamp}})])})),0)})),0)]),i("div",{staticClass:"switch",attrs:{flex:""}},t._l(t.config.sticker,(function(e,a){return i("span",{class:{active:t.stickerSlideNow===a},attrs:{flex:""},on:{click:function(e){t.stickerSlideNow=a}}},[t._v(t._s(e.name))])})),0)]):t._e()]),i("div",{staticClass:"body",attrs:{flex:""}},[i("div",{staticClass:"markdown",style:{width:t.mdWidth},attrs:{flex:""}},[i("div",{ref:"textarea",staticClass:"textarea"})]),i("resizer",{attrs:{orient:"h"},on:{start:t.startResize,resize:t.doResize}}),i("div",{staticClass:"html",attrs:{flex:""}},[i("span",{directives:[{name:"viewer",rawName:"v-viewer"}],ref:"html",staticClass:"--markdown",domProps:{innerHTML:t._s(t.htmlText)}})])],1)]),i("markdown-help",{directives:[{name:"show",rawName:"v-show",value:t.showGuide,expression:"showGuide"}],nativeOn:{click:function(e){if(e.target!==e.currentTarget)return null;t.showGuide=!1}}})],1)},n=[],s=(i("b4fb"),i("4194"),i("ea69"),i("053b"),i("e18c"),i("1c2e"),i("af86"),i("19d5")),r=(i("6a61"),i("327b")),c=i("82b2"),o=i("fa7d"),d=i("44b8"),l=i("8e8da"),u=i("3347"),f=i.n(u),h=(i("98b4"),i("3096"),i("f79f"),i("e17d"),i("c588"),i("547e"),i("58a6"),i("3259")),m=i("b33a"),g=i("7081"),p=i("cf34"),v=i("c247"),b=i.n(v),k=i("a1c1"),x=i("2a7d"),w={name:"ArticleDetail",components:{SingleButton:x["a"],LoadingImg:g["a"],MarkdownHelp:m["a"],Resizer:h["a"],LoadingButton:l["a"],FloatInput:d["a"]},props:{md:{type:Array,default:function(){return[]}},inited:{type:Boolean,default:!1}},data:function(){return{stamp:b.a.timeStamp,baseUrl:c["a"],showGuide:!1,showSticker:!1,stickerSlideNow:0,focusAt:0,tagEditIndex:-1,mdText:"",codeMirror:null,mdWidth:"40%",resizeStart:{pos:!1,size:!1},saving:{b:!1,state:""},hasCache:!1,info:{},newInfo:{name:"编辑标题",file:"",cover:"",time:"",modifyTime:"",summary:"编辑简介",tags:[]}}},computed:{id:function(){return this.$route.params.id},htmlText:function(){return Object(p["a"])(this.mdText)},gitUtil:function(){return this._gitUtil()},config:function(){return this._config()}},inject:["_config","_gitUtil"],watch:{"$props.inited":function(){this.init()},htmlText:function(){var t=this;this.$nextTick((function(){Object(p["b"])(t.$refs.html)}))}},beforeRouteEnter:function(t,e,i){i((function(t){t.$props.inited&&t.init()}))},created:function(){this.hasCache=null!==Object(k["c"])("article-".concat(this.id))},methods:{init:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){var i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.info=JSON.parse(JSON.stringify("new"===t.id?t.newInfo:t.md.find((function(e){return e.file===t.id}))||t.newInfo)),i="写点什么吧","new"!==t.id){e.next=6;break}document.title="后台-文章-新建",e.next=11;break;case 6:return document.title="后台-文章-"+t.id,e.next=9,Object(o["a"])("".concat(c["b"],"/md/").concat(t.id,".md"));case 9:a=e.sent,a[0]?i=a[1]:t.$message.error(Object(o["c"])(a[1]));case 11:t.codeMirror||(t.codeMirror=new f.a(t.$refs.textarea,{indentUnit:2,tabSize:2,theme:"light",lineNumbers:!0,line:!0,mode:"markdown",matchTags:{bothTags:!0},matchBrackets:!0}),t.codeMirror.on("change",(function(){t.mdText=t.codeMirror.getValue()})),t.codeMirror.on("blur",(function(){t.focusAt=t.codeMirror.getCursor()}))),t.codeMirror.setValue(i);case 13:case"end":return e.stop()}}),e)})))()},enableSticker:function(t){if(this.showSticker)return document.removeEventListener("click",this.handleStickerDiv),void(this.showSticker=!1);this.showSticker=!0,t.stopPropagation(),document.addEventListener("click",this.handleStickerDiv)},handleStickerDiv:function(t){var e=this,i=this.$refs.sticker,a=t.target;while(1){if(a===i)break;if(a=a.parentElement,!a){document.removeEventListener("click",this.handleStickerDiv),e.showSticker=!1;break}}},addSticker:function(t,e){this.focusAt?(this.codeMirror.replaceRange("![sticker](".concat(t,"/").concat(e,")"),this.focusAt),document.removeEventListener("click",this.handleStickerDiv),this.showSticker=!1):this.$message.warning("请先选择输入框!")},delCache:function(){Object(k["a"])("article-".concat(this.id)),Object(k["a"])("article-".concat(this.id,"-text")),this.$message.success("草稿已删除"),this.hasCache=!1},useCache:function(){this.info=JSON.parse(Object(k["c"])("article-".concat(this.id))),this.codeMirror.setValue(Object(k["c"])("article-".concat(this.id,"-text"))),this.$message.success("草稿已加载")},saveCache:function(){Object(k["d"])("article-".concat(this.id),JSON.stringify(this.info)),Object(k["d"])("article-".concat(this.id,"-text"),this.mdText),this.$message.success("草稿已保存"),this.hasCache=!0},inputTitle:function(t){this.info.name=t[1]},inputSummary:function(t){this.info.summary=t[1]},changeCover:function(t){this.info.cover=t.target.value},clickTrash:function(t){this.info.tags.splice(t,1)},clickEdit:function(t){var e=t.currentTarget;this.tagEditIndex=parseInt(e.getAttribute("data-idx")),this.$nextTick((function(){e.parentElement.previousElementSibling.focus()}))},editTag:function(t){var e=this.info,i=t.target;this.tagEditIndex=-1;var a,n=Object(s["a"])(e.tags);try{for(n.s();!(a=n.n()).done;){var r=a.value;if(r!==i.getAttribute("data-old")&&r===i.value)return this.$message.warning("标签不能重复!")}}catch(c){n.e(c)}finally{n.f()}e.tags.splice(parseInt(i.getAttribute("data-idx")),1,i.value)},addTag:function(){this.info.tags.push("输入标签"+this.info.tags.length)},startResize:function(t){this.resizeStart={pos:t,size:this.$refs.text.querySelector(".markdown").scrollWidth}},doResize:function(t){var e=this.$refs.text.scrollWidth,i=this.resizeStart.size+(t-this.resizeStart.pos);i>e/5&&i<4*e/5&&(this.mdWidth="".concat(i,"px"))},save:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){var i,a,n,s,r,c,d;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.saving.b){e.next=2;break}return e.abrupt("return");case 2:if(!t.gitUtil){e.next=43;break}if(i=null,a=t.info,a.name&&a.summary&&a.tags.length&&a.cover){e.next=6;break}return e.abrupt("return",t.$message.warning("标题,简介,标签和封面均不能为空!"));case 6:t.saving={b:!0,state:"保存中..."},n=(new Date).getTime(),a.modifyTime=n,"new"!==t.id?n=t.id:(a.file=n.toString(),a.time=n,t.md.push(JSON.parse(JSON.stringify(a)))),e.t0=regeneratorRuntime.keys(t.md);case 11:if((e.t1=e.t0()).done){e.next=18;break}if(s=e.t1.value,t.md[s].file!==t.id){e.next=16;break}return t.md[s]=a,e.abrupt("break",18);case 16:e.next=11;break;case 18:return t.saving.state="更新:md.json",Object(o["d"])(t.md),e.next=22,t.gitUtil.updateJsonFile("md.json",t.md);case 22:if(r=e.sent,!r[0]){e.next=38;break}return e.next=26,t.gitUtil.updateMd({file:n,md:t.mdText},t.saving);case 26:if(c=e.sent,!c[0]){e.next=35;break}return t.saving.state="更新 RSS",e.next=31,t.gitUtil.updateSingleFile("dynamic/rss.xml",Object(k["b"])(t.md));case 31:d=e.sent,d[1]?(t.$message.success("上传成功!"),window.location.reload()):i=d[1],e.next=36;break;case 35:i=c[1];case 36:e.next=39;break;case 38:i=r[1];case 39:i&&t.$message.error(Object(o["c"])(i)),t.saving={b:!1,state:""},e.next=45;break;case 43:t.$message.warning("请先登录!"),t.$emit("login");case 45:case"end":return e.stop()}}),e)})))()}}},C=w,S=(i("869d"),i("9ca4")),y=Object(S["a"])(C,a,n,!1,null,"69829ca3",null);e["default"]=y.exports},"869d":function(t,e,i){"use strict";var a=i("ccbe"),n=i.n(a);n.a},9302:function(t,e,i){"use strict";var a=i("1c8b"),n=i("692f"),s=i("da10"),r=i("d7e1"),c=[].join,o=n!=Object,d=r("join",",");a({target:"Array",proto:!0,forced:o||!d},{join:function(t){return c.call(s(this),void 0===t?",":t)}})},a1c1:function(t,e,i){"use strict";i.d(e,"d",(function(){return s})),i.d(e,"c",(function(){return r})),i.d(e,"a",(function(){return c})),i.d(e,"b",(function(){return d}));i("f3dd"),i("0a51"),i("b4fb"),i("9302"),i("77ad"),i("053b"),i("e18c"),i("e35a"),i("1c2e"),i("5e9f");var a=i("19d5"),n=i("8b68");function s(t,e){window.localStorage.setItem("cache-"+t,e)}function r(t){return window.localStorage.getItem("cache-"+t)}function c(t){return window.localStorage.removeItem("cache-"+t)}var o=i("c247");function d(t){if("update"===o.rss.timeBy){var e=t.slice();e.sort((function(t,e){return t.modifyTime>e.modifyTime?-1:1})),t=e}t=t.slice(0,o.rss.count);var i=location.origin;function s(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function r(t,e,i){var a=c.createElement(t);return e&&(e=e.toString(),a.innerHTML=i?e:s(e)),a}var c=(new DOMParser).parseFromString('<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"></rss>',"application/xml"),d=c.getElementsByTagName("rss")[0],l=r("channel","");l.appendChild(r("title",o.rss.title)),l.appendChild(r("link",i)),l.appendChild(r("description",o.rss.description)),l.appendChild(r("ttl",o.rss.ttl)),l.appendChild(r("category",o.rss.categories)),l.appendChild(r("lastBuildDate",Object(n["a"])((new Date).getTime(),!1))),l.appendChild(r("language","zh-cn"));var u,f=Object(a["a"])(t);try{for(f.s();!(u=f.n()).done;){var h=u.value,m=r("item");m.appendChild(r("author",o.owner)),m.appendChild(r("title",h.name)),m.appendChild(r("link",i+"/article/"+h.file)),m.appendChild(r("description","\n            <h3><b>".concat(h.name,'</b></h3>\n            <span style="display: block">').concat(h.summary,'</span>\n            <img src="').concat(h.cover,'" alt=""/>\n        '),!0)),m.appendChild(r("category",h.tags.join("/"))),m.appendChild(r("pubDate",Object(n["a"])("create"===o.rss.timeBy?h.time:h.modifyTime,!1))),m.appendChild(r("guid",h.time)),l.appendChild(m)}}catch(g){f.e(g)}finally{f.f()}return d.appendChild(l),(new XMLSerializer).serializeToString(c)}},ccbe:function(t,e,i){}}]);